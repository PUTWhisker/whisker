<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="text_file_io.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="history_style.css">
    <script src='https://mozilla.github.io/nunjucks/files/nunjucks.min.js'></script>
</head>

<body>
    <script>
        function clipString(str) {
            const limit = 128;
            if (str.length > limit) return `${str.substring(0, limit - 3)}...`
            else return str;
        }
        function expandText(text) {
            text.classList.toggle("expanded");
            text.innerText = text.classList.contains("expanded") ? text.getAttribute("data-text") : clipString(text.getAttribute("data-text"));
        }
        const nj = `
        <div class="event_view">
            <div class="event_date_view">{{ timestampToDate(event.getCreatedAt()) }}</div>
            <div class="event_title">Titles not fully supported yet (I guess)</div>
            <div class="event_previews_view">
                <div class="event_text_row">
                    {% if event.getTranscriptionLanguage is defined %}
                        <div class="text_flag">{{ event.getTranscriptionLanguage() }}</div>
                    {% else %}
                        <div class="text_flag">?</div>   <!-- GETLANGAUGE??? GETSOURCELANGUAGE??? PREGANTE??? CO TU ZA FUNKCJA MA BYĆ DO JEMZYKA -->
                    {% endif %}
                    <div class="preview_text" data-text="{{ event.getTranscription() }}" onclick="expandText(this);">
                        {{ clipString(event.getTranscription()) }}
                    </div>
                    <button class="option_button" onclick="() => speak('{{ event.getTranscription() }}', 'en-us');">   <!-- GETLANGAUGE??? GETSOURCELANGUAGE??? PREGANTE??? CO TU ZA FUNKCJA MA BYĆ DO JEMZYKA -->
                        <span class="material-symbols-outlined">brand_awareness</span>
                    </button>
                    <button class="option_button" onclick="(_) => copyToClipboard('{{ event.getTranscription() }}');">
                        <span class="material-symbols-outlined">content_copy</span>
                    </button>
                    <button class="option_button" onclick="(_) => downloadAsFile('{{ event.getTranscription() }}', 'transcription.txt');">
                        <span class="material-symbols-outlined">download</span>
                    </button>
                </div>
                {% if mode == "translation" %}
                    <div class="event_text_row">
                        <div class="text_flag">{{ event.getTranslationLangauge() }}</div>
                        <div class="preview_text" data-text="{{ event.getTranslation() }}" onclick="expandText(this);">
                            {{ clipString(event.getTranslation()) }}
                        </div>
                        <button class="option_button" onclick="speak('{{ event.getTranslation() }}', 'en-us');">   <!-- GETLANGAUGE??? GETSOURCELANGUAGE??? PREGANTE??? CO TU ZA FUNKCJA MA BYĆ DO JEMZYKA -->
                            <span class="material-symbols-outlined">brand_awareness</span>
                        </button>
                        <button class="option_button" onclick="(_) => copyToClipboard('{{ event.getTranslation() }}');">
                            <span class="material-symbols-outlined">content_copy</span>
                        </button>
                        <button class="option_button" onclick="downloadAsFile('{{ event.getTranslation() }}', 'translation.txt');">
                            <span class="material-symbols-outlined">download</span>
                        </button>
                    </div>
                {% endif %}
            </div>
            <div class="delete-button-container">
                <button class="option_button" onclick="alert('here be delete');">
                    <span class="material-symbols-outlined">delete</span>
                </button>
            </div>
        </div>
        `;
        const njTemplate = nunjucks.compile(nj);
        const emptyHistory = `
        <div style="display:inline-block;" class="centered-message">nothing to show yet</div>
        `;
    </script>
    <header>
        <div id="top_menu">
            <p>Whisker+</p>
            <a href="/webApp/index.html" class="icon_button">
                Transcribe <span class="material-symbols-outlined">edit_document</span>
            </a>
            <a href="/webApp/record.html" class="icon_button">
                Dictate <span class="material-symbols-outlined">mic</span>
            </a>
            <a href="#" class="icon_button selected">
                History <span class="material-symbols-outlined">lock</span>
            </a>
            <a href="/webApp/swagger.html" class="icon_button locked">
                Swagger <span class="material-symbols-outlined">lock</span>
            </a>
            <a href="/webApp/about.html" class="icon_button">
                About <span class="material-symbols-outlined">help</span>
            </a>
            <div id="blank_space"></div>
        </div>
        <div class="header selected" id="navigation">
            <div class="tab_button selected" onclick="openTab(this, 'translation')">
                <div>Translations</div>
            </div>
            <div class="tab_button" onclick="openTab(this, 'transcription')">
                <div>Transcriptions</div>
            </div>
        </div>
    </header>
    <main>
        <div id="page_view">
            <div id="filter_options" class="main_content">
                <div>
                </div>
            </div>
            <div id="main_container" class="main_content">
                <div id="translation_history" class="tab"></div>
                <div id="transcription_history" class="hidden tab"></div>
                <div id="diarization_history" class="hidden tab"></div>
            </div>
        </div>
    </main>
    <script src="dist/history.js">
    </script>
</body>

</html>