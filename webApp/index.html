<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <meta charset="UTF-8">
  <title>DEMO PAGE</title>
  <script src="./dist/main.js"></script>
  <script>
    function showTransBox() {
      document.getElementById("show_transcript").style.display = 'block';
    }

    function showTransOptions() {
      const checkbox = document.getElementById("translate");
      const langlist = document.getElementById("trans_lang_list");
      const translationfield = document.getElementById("show_translation");
      if (checkbox.checked) {
        langlist.classList.remove('hidden');
        translationfield.classList.remove('hidden');
      } else {
        langlist.classList.add('hidden');
        translationfield.classList.add('hidden');
      }
    }
    function handleUpload(file) {
      const fileNameLabel = document.getElementById("file_name");
      const sourceLangTile = document.getElementById("source_language_container");
      const languageChooser = document.getElementById("choose_lang");
      console.log(`File ${file.name} hast became the chosen one`);
      sourceLangTile.classList.remove("locked");
      languageChooser.disabled = false;
      fileNameLabel.classList.remove("hidden");
      var visibleName = file.name;
      if (visibleName.length > 20)
        visibleName = `${visibleName.substring(0, 9)}...${visibleName.substring(visibleName.length - 8)}`
      fileNameLabel.innerHTML = `Selected file:<br>${visibleName}`;
    }
    function dropHandle(event) {
      event.preventDefault();
      if (event.dataTransfer.items.length == 1) {
        const file = event.dataTransfer.items[0];
        if (file.kind == "file") {
          const actuallyFile = file.getAsFile();
          handleUpload(actuallyFile);
        }
      }
    }
  </script>
  <link rel="stylesheet" href="style.css">
  <link rel="shortcut icon" href="#">
</head>

<body>
  <main>
    <div id="top_menu">
      <a href="http://127.0.0.1:5500/webApp/record.html">Switch to dictate</a>
      <div id="blank_space"></div>
      <a href="http://127.0.0.1:5500/webApp/login.html">Log in</a>
      <a href="http://127.0.0.1:5500/webApp/signup.html">Sign up</a>
    </div>
    <div id="settings_fields">
      <div id="submit_file_container" class="options_div">
        <div class="fields_in_options">
          <div class="field_container">
            <p id="upload_msg" class="step_label">Drag and drop an audio file or</p>
          </div>
          <div class="field_container">
            <input type="file" id="upload" hidden />
            <label for="upload" id="input_file" class="icon_button">Browse
              <span class="material-symbols-outlined">folder_open</span>
            </label>
          </div>
          <div id="file_name" class="step_label hidden"></div>
        </div>
        <div class="steps">
          <div>1</div>
        </div>
      </div>
      <div id="source_language_container" class="options_div locked">
        <div class="fields_in_options">
          <div class="field_container">
            <p id="choose_lang_msg" class="step_label">Choose the source language of your file</p>
          </div>
          <div class="field_container">
            <select id="choose_lang" disabled>
              <option disabled selected>Select...</option>
              <option>Polish</option>
              <option>English</option>
              <option>German</option>
            </select>
          </div>
        </div>
        <div class="steps">
          <div>2</div>
        </div>
      </div>
      <div id="translation_options_container" class="options_div locked">
        <div class="fields_in_options">
          <div class="field_container" id="optional_checkboxes">
            <!-- <p id="choose_lang_msg">Choose the source language of your file</p> -->
            <label id="role_devision_checkbox">
              <input type="checkbox" id="role_devision" disabled>
              <span class="checkbox_label">Differentiate speakers</span>
            </label>
            <label id="translate_checkbox">
              <input type="checkbox" id="translate" onclick="showTransOptions()" disabled>
              <span class="checkbox_label">Translate</span>
            </label>
          </div>
          <div class="field_container hidden" id="trans_lang_list">
            <select id="choose_trans_lang" disabled>
              <option disabled selected>Choose language</option>
              <option>Polish</option>
              <option>English</option>
              <option>German</option>
            </select>
          </div>
        </div>
        <div class="steps">
          <div>3</div>
        </div>
      </div>
      <div id="fourth_tile" class="options_div locked">
        <div class="fields_in_options">
          <div class="field_container">
            <p id="ready_msg" class="step_label"></p>
          </div>
          <div class="field_container">
            <button id="start" class="icon_button">START <span class="material-symbols-outlined">start</span></button>
          </div>
        </div>
        <div class="steps">
          <div>4</div>
        </div>
      </div>
    </div>
    <div id="results_fields">
      <!-- <fieldset id="show_transcript">
        <legend>Transcript</legend>
        <form id="receive_transcript">
          <p id="transcriptedText"></p>
        </form>
      </fieldset> -->
      <fieldset id="show_transcript" class="result_windows">
        <legend>Transcript</legend>
        <button onclick="copyToClipboard(document.getElementById('transcription_result').innerText)">
          <span class="material-symbols-outlined">content_copy</span>
        </button>
        <span id="transcription_result" class="result_span">&nbsp; en en en en en en en en en en en en en en en en en en
          en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en
          en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en
          en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en en </span>
      </fieldset>
      <fieldset id="show_translation" class="result_windows hidden">
        <legend>Translation</legend>
        <button onclick="copyToClipboard(document.getElementById('translation_result').innerText)">
          <span class="material-symbols-outlined">content_copy</span>
        </button>
        <span id="translation_result" class="result_span">&nbsp;</span>
      </fieldset>
    </div>
  </main>
  <script>
    const uploadButton = document.getElementById("upload");
    const languageChooser = document.getElementById("choose_lang");
    const optionsTile = document.getElementById("translation_options_container");
    const translationCheckbox = document.getElementById("translate");
    const rolesCheckbox = document.getElementById("role_devision");
    const translationList = document.getElementById("choose_trans_lang");
    const fourthTile = document.getElementById("fourth_tile");
    document.body.addEventListener("drop", (e) => {
      e.preventDefault();
      dropHandle(e);
    });
    document.body.addEventListener("dragdrop", (e) => {
      e.preventDefault();
      dropHandle(e);
    });
    document.body.addEventListener("dragenter", (e) => {
      e.preventDefault();
    });
    document.body.addEventListener("dragleave", (e) => {
      e.preventDefault();
    });
    document.body.addEventListener("dragover", (e) => {
      e.preventDefault();
    });
    uploadButton.addEventListener("change", (e) => {
      if (e.target.files.length == 1) {
        handleUpload(e.target.files[0]);
      }
    });
    languageChooser.addEventListener("change", () => {
      if (languageChooser.selectedIndex != 0) {
        optionsTile.classList.remove("locked");
        translationCheckbox.disabled = false;
        rolesCheckbox.disabled = false;
        translationList.disabled = false;
        fourthTile.classList.remove("locked");
      }
    });

    function copyToClipboard(text) {
      if (location.protocol === 'https:') {
        navigator.clipboard.writeText(text)
          .then(() => { })
          .catch((err) => console.error('Unable to copy to clipboard', err));
      } else {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
          document.execCommand('copy');
        } catch (err) {
          console.error('Unable to copy to clipboard', err);
        }
        document.body.removeChild(textArea);
      }
    }
  </script>
</body>

</html>